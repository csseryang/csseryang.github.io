---
title: 201 Project1
tags: [201]
---
<!DOCTYPE html><html><head><style type="text/css" id="wiz_custom_css"> html, body { font-size: 15px; } body { font-family: Helvetica, "Hiragino Sans GB", "Microsoft Yahei", SimSun, SimHei, arial, sans-serif; line-height: 1.6; padding: 0; margin: 20px 36px; margin: 1.33rem 2.4rem; } h1, h2, h3, h4, h5, h6 { margin: 20px 0 10px; margin: 1.33rem 0 0.667rem; padding: 0; font-weight: bold; } h1 { font-size: 21px; font-size: 1.4rem; } h2 { font-size: 20px; font-size: 1.33rem; } h3 { font-size: 18px; font-size: 1.2rem; } h4 { font-size: 17px; font-size: 1.13rem; } h5 { font-size: 15px; font-size: 1rem; } h6 { font-size: 15px; font-size: 1rem; color: #777777; margin: 1rem 0; } div, p, blockquote, ul, ol, dl, table, pre { margin: 10px 0; margin: 0.667rem 0; } ul, ol { padding-left: 32px; padding-left: 2.13rem; } blockquote { border-left: 4px solid #dddddd; padding: 0 12px; padding: 0 0.8rem; color: #aaa; } blockquote > :first-child { margin-top: 0; } blockquote > :last-child { margin-bottom: 0; } img { border: 0; max-width: 100%; height: auto !important; } table { border-collapse: collapse; border: 1px solid #bbbbbb; } td { border-collapse: collapse; border: 1px solid #bbbbbb; } @media screen and (max-width: 660px) { body { margin: 20px 18px; margin: 1.33rem 1.2rem; } } @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) { html, body { font-size: 17px; } body { line-height: 1.7; margin: 12px 15px; margin: 0.75rem 0.9375rem; color: #353c47; } h1 { font-size: 34px; font-size: 2.125rem; } h2 { font-size: 30px; font-size: 1.875rem; } h3 { font-size: 26px; font-size: 1.625rem; } h4 { font-size: 22px; font-size: 1.375rem; } h5 { font-size: 18px; font-size: 1.125rem; } h6 { color: inherit; } div, p, blockquote, ul, ol, dl, table, pre { margin: 0; } ul, ol { padding-left: 40px; padding-left: 2.5rem; } blockquote { border-left: 4px solid #c8d4e8; padding: 0 15px; padding: 0 0.9375rem; color: #b3c2dd; } } </style><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked { /*text-decoration: line-through;*/ color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head><body><h2 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">CS 201 Project</h2><p><b style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Handed Out: Apr 21, 2016&nbsp;<br/>Due: May 24, 2016&nbsp;<br/>Grade Weight: 30% of total course grade&nbsp;<br/>This assignment can be done individually, or in a group of two.&nbsp;<br/></b><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/></p><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="project_description" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Project Description</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The goal of this project is to understand and implement the basic program analysis and instrumentation techniques. In this project, you are required to implement the following profiling methods:</span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li><b>Basic Block Profiling:</b>&nbsp;Basic block profiling collects the execution frequency of each basic block executed during a specific program run.</li><li><b>Edge Profiling:</b>&nbsp;Edge profiling collects the execution frequency of each control-flow edge executed during a specific program run.</li><li><b>Loop Iterations Count:</b>&nbsp;For each execution of a loop during a program run, collect the number of times the loop iterates.</li></ol><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">You will carry out this project as follows:</span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li>Parse the input file, collect the control flow information, and identify all the loops.</li><li>Instrument the code to find the execution frequency of each basic block, control flow edge, and loop.</li><li>Run the instrumented code and output the profiling information.</li></ol><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">More details about the languages, tools, output requirements and submission format can be found in the following:</span></p><ul style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li><a href="http://www.cs.ucr.edu/~aalav003/#ir">LLVM Intermediate Representation</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#getting_started">Getting Started with LLVM</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#working_example">Working Example of LLVM Transformation</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#profiling">Profiling Using LLVM IR: Setup and Program Template</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#output">Output Requirements</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#submission">Submission</a></li><li><a href="http://www.cs.ucr.edu/~aalav003/#reporting_problems">Reporting Problems</a></li></ul><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="ir" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">The LLVM Intermediate Representation (IR)</h3><p><a href="http://llvm.org/" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">LLVM</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;provides a framework for writing compiler passes that operate (e.g., to optimize or instrument) upon LLVM Intermediate Representation language. A detailed definition of the LLVM IR can be found in the&nbsp;</span><a href="http://llvm.org/docs/LangRef.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">LLVM Language Reference Manual</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">. Below is an example of a simple C program, and the corresponding LLVM IR.</span></p><h4 style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">An unconventional hello world in C</h4><pre class="prettyprint lang-cpp prettyprinted" style="padding: 2px; border: 1px solid rgb(136, 136, 136); line-height: normal; widows: 1;"><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&lt;stdio.h&gt;</span><span class="pln">

</span><span class="typ" style="color: rgb(102, 0, 102);">int</span><span class="pln"> main</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln">
 &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">int</span><span class="pln"> x </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">5</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln">
 &nbsp;printf</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="str" style="color: rgb(0, 136, 0);">&quot;Hello World; x = %d\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> x</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln">

 &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln">
</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></pre><h4 style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The Corresponding LLVM IR</h4><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The LLVM IR for the above source code can be obtained by running:&nbsp;</span><code class="prettyprint lang-sh prettyprinted" style="line-height: normal; white-space: normal; widows: 1;"><span class="pln">$ clang&nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln">emit</span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln">llvm hello</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">c&nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln">S&nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln">o hello</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">bc</span></code><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><pre class="prettyprint lang-llvm prettyprinted" style="padding: 2px; border: 1px solid rgb(136, 136, 136); line-height: normal; widows: 1;"><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">ModuleID</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&#39;support/hello.c&#39;</span><span class="pln">
target datalayout </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;e-m:o-i64:64-f80:128-n8:16:32:64-S128&quot;</span><span class="pln">
target triple </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;x86_64-apple-macosx10.10.0&quot;</span><span class="pln">

</span><span class="pun" style="color: rgb(102, 102, 0);">@.</span><span class="pln">str </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">private</span><span class="pln"> unnamed_addr constant </span><span class="pun" style="color: rgb(102, 102, 0);">[</span><span class="lit" style="color: rgb(0, 102, 102);">21</span><span class="pln"> x i8</span><span class="pun" style="color: rgb(102, 102, 0);">]</span><span class="pln"> c</span><span class="str" style="color: rgb(0, 136, 0);">&quot;Hello World; x = %d\0A\00&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> align </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pln">

</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Attrs</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln"> nounwind ssp uwtable
define i32 </span><span class="lit" style="color: rgb(0, 102, 102);">@main</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">#0 {</span><span class="pln">
 &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> alloca i32</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> align </span><span class="lit" style="color: rgb(0, 102, 102);">4</span><span class="pln">
 &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="pln">x </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> alloca i32</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> align </span><span class="lit" style="color: rgb(0, 102, 102);">4</span><span class="pln">
 &nbsp;store i32 </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> i32</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pln">
 &nbsp;store i32 </span><span class="lit" style="color: rgb(0, 102, 102);">5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> i32</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="pln">x</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> align </span><span class="lit" style="color: rgb(0, 102, 102);">4</span><span class="pln">
 &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="lit" style="color: rgb(0, 102, 102);">2</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> load i32</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="pln">x</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> align </span><span class="lit" style="color: rgb(0, 102, 102);">4</span><span class="pln">
 &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="lit" style="color: rgb(0, 102, 102);">3</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> call i32 </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">i8</span><span class="pun" style="color: rgb(102, 102, 0);">*,</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">...)*</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">@printf</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">i8</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> getelementptr inbounds </span><span class="pun" style="color: rgb(102, 102, 0);">([</span><span class="lit" style="color: rgb(0, 102, 102);">21</span><span class="pln"> x i8</span><span class="pun" style="color: rgb(102, 102, 0);">]*</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">@.</span><span class="pln">str</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> i32 </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> i32 </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> i32 </span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="lit" style="color: rgb(0, 102, 102);">2</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln">
 &nbsp;ret i32 </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pln">
</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln">

declare i32 </span><span class="lit" style="color: rgb(0, 102, 102);">@printf</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">i8</span><span class="pun" style="color: rgb(102, 102, 0);">*,</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">...)</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">#1</span><span class="pln">

attributes </span><span class="com" style="color: rgb(136, 0, 0);">#0 = { nounwind ssp uwtable &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-frame-pointer-elim&quot;=&quot;true&quot; &quot;no-frame-pointer-elim-non-leaf&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; }</span><span class="pln">
attributes </span><span class="com" style="color: rgb(136, 0, 0);">#1 = { &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-frame-pointer-elim&quot;=&quot;true&quot; &quot;no-frame-pointer-elim-non-leaf&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; }</span><span class="pln">

</span><span class="pun" style="color: rgb(102, 102, 0);">!</span><span class="pln">llvm</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">ident </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">!{!</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln">

</span><span class="pun" style="color: rgb(102, 102, 0);">!</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> metadata </span><span class="pun" style="color: rgb(102, 102, 0);">!{</span><span class="pln">metadata </span><span class="pun" style="color: rgb(102, 102, 0);">!</span><span class="str" style="color: rgb(0, 136, 0);">&quot;Apple LLVM version 6.0 (clang-600.0.57) (based on LLVM 3.5svn)&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></pre><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="getting_started" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Getting Started with LLVM</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The pre-requisites for working with LLVM are as follows:</span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li>Familiarity with C++; Additionally, knowledge of certain C++11 features like&nbsp;<tt><a href="http://en.cppreference.com/w/cpp/language/auto">auto</a></tt>&nbsp;can help better understand examples in the LLVM documentation.</li><ul class=" list-paddingleft-2"><li><a href="http://matt.might.net/articles/c++-template-meta-programming-with-lambda-calculus/">Template programming with C++</a></li><li>You should be comfortable reading programs that use templates. You should also be comfortable using templates. It is not necessary for you to know how to write template functions yourself.</li><li><a href="https://www3.ntu.edu.sg/home/ehchua/programming/cpp/cp3_OOP.html">Object Oriented Programming in C++</a></li><li>Again, you should be comfortable reading and using object oriented code, but you do not necessarily need to know how to write object oriented code yourself.</li><li><a href="https://www.cs.bu.edu/teaching/cpp/inheritance/intro/">Inheritance in C++</a></li><li>The LLVM libraries are designed with an object oriented philosophy. They make extensive use of inheritance and polymorphism. You should be comfortable reading and using code that employs these techniques.</li><li><a href="http://www.cplusplus.com/reference/stl/">C++ Standard Template Library</a></li><li>LLVM makes extensive use of the C++ Standard Template Library (STL) as well. In addition, the design philosophy of LLVM closely mirrors that of the STL in many respects. You should be comfortable with the design paradisgms of the STL, such as iterators, streams, etc.</li></ul><li>On-demand faimilarity with the&nbsp;<a href="http://www.llvm.org/docs/LangRef.html">LLVM Language Reference</a></li><li>Upfront faimiliarity with the&nbsp;<a href="http://llvm.org/docs/ProgrammersManual.html">LLVM Programmer&#39;s Manual</a></li><li>Cursory understanding of the&nbsp;<a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Design Pattern</a></li><li>Familiarity with compiler terminology like&nbsp;<tt>BasicBlock</tt>s etc.</li></ol><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="working_example" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Working Example of Program Instrumentation using LLVM</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">We now describe the use of LLVM for program&nbsp;</span><a href="http://llvm.org/docs/ProgrammersManual.html#basic-inspection-and-traversal-routines" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">inspection</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;and&nbsp;</span><a href="http://llvm.org/docs/ProgrammersManual.html#making-simple-changes" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">transformation</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">, by writing an&nbsp;</span><b style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><i>LLVM pass</i></b><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">.&nbsp;</span><a href="http://www.llvm.org/docs/WritingAnLLVMPass.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Writing an LLVM Pass</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;outlines the basic writing of an LLVM transform and a simplified example is provided here.</span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Programs in LLVM IR code are organized as a four-level hierarchy:&nbsp;</span><a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Module.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><tt>Module</tt></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">,&nbsp;</span><a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Function.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><tt>Function</tt></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">,&nbsp;</span><a href="http://llvm.org/docs/doxygen/html/classllvm_1_1BasicBlock.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><tt>BasicBlock</tt></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;and&nbsp;</span><a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Instruction.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><tt>Instruction</tt></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">. That is, each LLVM program is composed of a&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">Module</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">s, one for each translation unit. A&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">Module</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;is a collection of&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">Function</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">s; a&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">Function</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;is a collection of&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">BasicBlock</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">s and a&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">BasicBlock</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;is a set of LLVM IR&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">Instruction</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">s in SSA form.&nbsp;</span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">This example counts the cumulative number of times&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">BasicBlock</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">s were encountered during program execution in a newly introduced global integer named&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">bbCounter</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">, which is incremented at the start of every&nbsp;</span><tt style="line-height: normal; white-space: normal; widows: 1;">BasicBlock</tt><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">.&nbsp;</span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The highlevel algorithm to do this is outlined as:</span></p><pre class="prettyprint prettyprinted" style="padding: 2px; border: 1px solid rgb(136, 136, 136); line-height: normal; widows: 1;"><span class="typ" style="color: rgb(102, 0, 102);">Create</span><span class="pln"> a </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pln"> bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln">
 &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">foreach</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Module</span><span class="pln"> M</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln">
 &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">foreach</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Funcion</span><span class="pln"> f </span><span class="kwd" style="color: rgb(0, 0, 136);">in</span><span class="pln"> M</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln">
 &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">foreach</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlock</span><span class="pln"> b </span><span class="kwd" style="color: rgb(0, 0, 136);">in</span><span class="pln"> F</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Add</span><span class="pln"> code to increment bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln">

</span><span class="typ" style="color: rgb(102, 0, 102);">At</span><span class="pln"> the </span><span class="kwd" style="color: rgb(0, 0, 136);">end</span><span class="pln"> of main</span><span class="pun" style="color: rgb(102, 102, 0);">(),</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">print</span><span class="pln"> bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></pre><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">This algorithm also outlines the basic structure of most LLVM transformations.&nbsp;</span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><b style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"><i>Code Walkthrough</i></b><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li>To create a GlobalVariable, we can do so in the&nbsp;<tt>Module</tt>&nbsp;that contains the&nbsp;<tt>Function</tt>s whose&nbsp;<tt>BasicBlock</tt>s we are interested in. This can be done in the&nbsp;<a href="http://llvm.org/docs/WritingAnLLVMPass.html#the-doinitialization-callgraph-method"><tt>bool doInitialization(Module &amp;M)</tt></a>&nbsp;function which is invoked&nbsp;<b><i>once</i></b>&nbsp;when the&nbsp;<tt>Module</tt>&nbsp;is first encountered. This is shown in lines 34 -- 46.</li><li>Line 37&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1GlobalVariable.html#af9ea64c7dae47dcfa2c9f5775fb5915d">creates</a>&nbsp;an integer&nbsp;<tt>GlobalVariable</tt>&nbsp;named&nbsp;<tt>bbCounter</tt>&nbsp;with&nbsp;<a href="http://llvm.org/docs/LangRef.html#linkage-types"><tt>InternalLinkage</tt></a>&nbsp;in the&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1LLVMContext.html"><tt>Context</tt></a>&nbsp;of the current&nbsp;<tt>Module</tt>.</li><li>To iterate over all functions in the code, the LLVM Transform needs to be a&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1FunctionPass.html"><tt>FunctionPass</tt></a>. This is achieved by publicly&nbsp;<b><i>inheriting</i></b>&nbsp;from the&nbsp;<tt>FunctionPass</tt>&nbsp;class as seen on line 25.</li><li>LLVM uses the&nbsp;<a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Design Pattern</a>: the&nbsp;<a href="http://llvm.org/docs/WritingAnLLVMPass.html#the-functionpass-class"><tt>runOnFunction(Function &amp;F)</tt></a>&nbsp;method (lines 59 -- 65) is invoked on each function, in&nbsp;<i>some</i>&nbsp;order. In this example, this function simply invokes&nbsp;<tt>runOnBasicBlock(BasicBlock &amp;BB)</tt>&nbsp;for each&nbsp;<tt>BasicBlock</tt>&nbsp;in the&nbsp;<tt>Function</tt>, as seen on line 64. Lines 61 -- 63 add the final&nbsp;<tt>printf</tt>&nbsp;to print&nbsp;<tt>bbCounter</tt>&nbsp;to the end of the &#39;exit&#39;&nbsp;<tt>BasicBlock</tt>&nbsp;of the&nbsp;<tt>main()</tt>&nbsp;function ensuing that the last statement is a&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1ReturnInst.html"><tt>ReturnInst</tt></a>&nbsp;(this is an approximate hack that works sufficiently for our purpose).</li><li>Next, the function&nbsp;<tt>runOnBasicBlock(BasicBlock &amp;BB)</tt>&nbsp;does the important task of creating and adding the LLVM IR instructions to&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f"><tt>CreateLoad</tt></a>&nbsp;to load&nbsp;<tt>bbCounter</tt>&nbsp;into a temporary variable&nbsp;<tt>loadAddr</tt>,&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99"><tt>CreateAdd()</tt></a>&nbsp;to add 1 to&nbsp;<tt>bbCounter</tt>,&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e"><tt>CreateStore()</tt></a>&nbsp;to store the new value to&nbsp;<tt>addAddr</tt>&nbsp;and store&nbsp;<tt>addAddr</tt>&nbsp;into&nbsp;<tt>bbCounter</tt>. Note that the temporary variables are used in accordance with SSA form which&nbsp;<i><u>requires</u></i>&nbsp;that each variable be assigned to exactly once. Observe the use of the&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1IRBuilder.html"><tt>IRBuilder</tt></a>&nbsp;class. This class provides the APIs to create various types of instructions and add them to specific locations of a&nbsp;<tt>BasicBLock</tt>&nbsp;ensuring that the inserted code is still SSA compliant.</li><li>Finally,&nbsp;<a href="http://llvm.org/docs/WritingAnLLVMPass.html#the-dofinalization-callgraph-method"><tt>doFinalization(Module &amp;M)</tt></a>&nbsp;can be used to perform any clean up&nbsp;<i>before</i>&nbsp;the visitor pattern finishes visiting the current&nbsp;<tt>Module</tt>.</li><li>Observe that all the functions return&nbsp;<tt>boolean</tt>; the functions should&nbsp;<tt>return true</tt>&nbsp;if they modify the&nbsp;<tt>Module/Function/BasicBlock/Instruction</tt>&nbsp;and&nbsp;<tt>false</tt>&nbsp;otherwise.</li><li>The&nbsp;<tt>addFinalPrintf(...)</tt>&nbsp;method creates an invocation to&nbsp;<tt>printf</tt>&nbsp;via the&nbsp;<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1IRBuilder.html#a902af4d6cb3a421a7f5723d0fc81efd1"><tt>CreateCall2()</tt></a>&nbsp;method.</li><li>You can use&nbsp;<tt>M.dump()</tt>&nbsp;or&nbsp;<tt>BB.dump()</tt>&nbsp;to debug your instrumentation: it prints the corresponding entity to&nbsp;<tt>stdout</tt>&nbsp;for you to inspect visually.</li></ol><pre class="prettyprint linenums lang-cpp prettyprinted" style="padding: 2px; border: 1px solid rgb(136, 136, 136); line-height: normal; widows: 1;"><ol class="linenums list-paddingleft-2" style="margin-top: 0px; margin-bottom: 0px;"><li class="L0" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/Pass.h&quot;</span></li><li class="L1" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/IR/Module.h&quot;</span></li><li class="L2" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/IR/Function.h&quot;</span></li><li class="L3" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/IR/BasicBlock.h&quot;</span></li><li class="L4"><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/IR/IRBuilder.h&quot;</span></li><li class="L5" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/Support/raw_ostream.h&quot;</span></li><li class="L6" style=""><span class="com" style="color: rgb(136, 0, 0);">#include</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;llvm/IR/Type.h&quot;</span></li><li class="L7" style=""><span class="pln">&nbsp;</span></li><li class="L8" style=""><span class="kwd" style="color: rgb(0, 0, 136);">using</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">namespace</span><span class="pln"> llvm</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln">&nbsp;</span></li><li class="L0" style=""><span class="kwd" style="color: rgb(0, 0, 136);">namespace</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L1" style=""><span class="pln"> &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// https://github.com/thomaslee/llvm-demo/blob/master/main.cc</span></li><li class="L2" style=""><span class="pln"> &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">static</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> printf_prototype</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">LLVMContext</span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln"> ctx</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Module</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">mod</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp;std</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">vector</span><span class="pun" style="color: rgb(102, 102, 0);">&lt;</span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">*&gt;</span><span class="pln"> printf_arg_types</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp;printf_arg_types</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">push_back</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt8PtrTy</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">ctx</span><span class="pun" style="color: rgb(102, 102, 0);">));</span></li><li class="L5" style=""><span class="pln">&nbsp;</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">FunctionType</span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln"> printf_type </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">FunctionType</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">get</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt32Ty</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">ctx</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> printf_arg_types</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">true</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">func </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> mod</span><span class="pun" style="color: rgb(102, 102, 0);">-&gt;</span><span class="pln">getFunction</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="str" style="color: rgb(0, 136, 0);">&quot;printf&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">if</span><span class="pun" style="color: rgb(102, 102, 0);">(!</span><span class="pln">func</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp;func </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">Create</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">printf_type</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">ExternalLinkage</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Twine</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="str" style="color: rgb(0, 136, 0);">&quot;printf&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> mod</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp;func</span><span class="pun" style="color: rgb(102, 102, 0);">-&gt;</span><span class="pln">setCallingConv</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">CallingConv</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">C</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> func</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L2" style=""><span class="pln"> &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L3" style=""><span class="pln"> &nbsp;</span></li><li class="L4"><span class="pln"> &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">struct</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlocksDemo</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">public</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">FunctionPass</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">static</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">char</span><span class="pln"> ID</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">LLVMContext</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlocksDemo</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">FunctionPass</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">ID</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{}</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">bbCounter </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> NULL</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlockPrintfFormatStr</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> NULL</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">printf_func </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> NULL</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L1" style=""><span class="pln">&nbsp;</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">//----------------------------------</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">bool</span><span class="pln"> doInitialization</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Module</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;\n---------Starting BasicBlockDemo---------\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getContext</span><span class="pun" style="color: rgb(102, 102, 0);">();</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;bbCounter </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">new</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt32Ty</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">false</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalValue</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">InternalLinkage</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">ConstantInt</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">get</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt32Ty</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;bbCounter&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">const</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">char</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">finalPrintString </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;BB Count: %d\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Constant</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">format_const </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">ConstantDataArray</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getString</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> finalPrintString</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlockPrintfFormatStr</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">new</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> llvm</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">ArrayType</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">get</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">llvm</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">IntegerType</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">get</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">8</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> strlen</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">finalPrintString</span><span class="pun" style="color: rgb(102, 102, 0);">)+</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">true</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> llvm</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">GlobalValue</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">PrivateLinkage</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> format_const</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;BasicBlockPrintfFormatStr&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;printf_func </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> printf_prototype</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L1" style=""><span class="pln">&nbsp;</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;Module: &quot;</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> M</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getName</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L3" style=""><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">true</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L6" style=""><span class="pln">&nbsp;</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">//----------------------------------</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">bool</span><span class="pln"> doFinalization</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Module</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">M</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;-------Finished BasicBlocksDemo----------\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L0" style=""><span class="pln">&nbsp;</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">false</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp;</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">//----------------------------------</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">bool</span><span class="pln"> runOnFunction</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">F</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> override </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;Function: &quot;</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> F</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getName</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&#39;\n&#39;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L7" style=""><span class="pln">&nbsp;</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">for</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);">auto</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln"> F</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// Add the footer to Main&#39;s BB containing the return 0; statement BEFORE calling runOnBasicBlock</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">if</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">F</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getName</span><span class="pun" style="color: rgb(102, 102, 0);">().</span><span class="pln">equals</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="str" style="color: rgb(0, 136, 0);">&quot;main&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;&amp;</span><span class="pln"> isa</span><span class="pun" style="color: rgb(102, 102, 0);">&lt;</span><span class="typ" style="color: rgb(102, 0, 102);">ReturnInst</span><span class="pun" style="color: rgb(102, 102, 0);">&gt;(</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getTerminator</span><span class="pun" style="color: rgb(102, 102, 0);">()))</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">// major hack?</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;addFinalPrintf</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlockPrintfFormatStr</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> printf_func</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;runOnBasicBlock</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L5" style=""><span class="pln">&nbsp;</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">true</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">// since runOnBasicBlock has modified the program</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L8" style=""><span class="pln">&nbsp;</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">//----------------------------------</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">bool</span><span class="pln"> runOnBasicBlock</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlock</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;BasicBlock: &quot;</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> BB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getName</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&#39;\n&#39;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">IRBuilder</span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&gt;</span><span class="pln"> IRB</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getFirstInsertionPt</span><span class="pun" style="color: rgb(102, 102, 0);">());</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">// Will insert the generated instructions BEFORE the first BB instruction</span></li><li class="L3" style=""><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Value</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">loadAddr </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> IRB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="typ" style="color: rgb(102, 0, 102);">CreateLoad</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Value</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">addAddr </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> IRB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="typ" style="color: rgb(102, 0, 102);">CreateAdd</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">ConstantInt</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">get</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">Type</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt32Ty</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">),</span><span class="pln"> loadAddr</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;IRB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="typ" style="color: rgb(102, 0, 102);">CreateStore</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">addAddr</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L7" style=""><span class="pln">&nbsp;</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">for</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);">auto</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln">I</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln"> BB</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;errs</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> I </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;\n&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L0" style=""><span class="pln">&nbsp;</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">true</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L3" style=""><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">//----------------------------------</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// Rest of this code is needed to: printf(&quot;%d\n&quot;, bbCounter); to the end of main, just BEFORE the return statement</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// For this, prepare the SCCGraph, and append to last BB?</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">void</span><span class="pln"> addFinalPrintf</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlock</span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln"> BB</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">LLVMContext</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">GlobalVariable</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">var</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Function</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">printf_func</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">IRBuilder</span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&gt;</span><span class="pln"> builder</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">BB</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">getTerminator</span><span class="pun" style="color: rgb(102, 102, 0);">());</span><span class="pln"> </span><span class="com" style="color: rgb(136, 0, 0);">// Insert BEFORE the final statement</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp;std</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="typ" style="color: rgb(102, 0, 102);">vector</span><span class="pun" style="color: rgb(102, 102, 0);">&lt;</span><span class="typ" style="color: rgb(102, 0, 102);">Constant</span><span class="pun" style="color: rgb(102, 102, 0);">*&gt;</span><span class="pln"> indices</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Constant</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">zero </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">Constant</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getNullValue</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">IntegerType</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getInt32Ty</span><span class="pun" style="color: rgb(102, 102, 0);">(*</span><span class="typ" style="color: rgb(102, 0, 102);">Context</span><span class="pun" style="color: rgb(102, 102, 0);">));</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;indices</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">push_back</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">zero</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;indices</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln">push_back</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">zero</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Constant</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">var_ref </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">ConstantExpr</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">getGetElementPtr</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">var</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> indices</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">Value</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">bbc </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> builder</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="typ" style="color: rgb(102, 0, 102);">CreateLoad</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">bbCounter</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ" style="color: rgb(102, 0, 102);">CallInst</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln">call </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> builder</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="typ" style="color: rgb(102, 0, 102);">CreateCall2</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">printf_func</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> var_ref</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> bbc</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp; &nbsp;call</span><span class="pun" style="color: rgb(102, 102, 0);">-&gt;</span><span class="pln">setTailCall</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);">false</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">};</span></li><li class="L0" style=""><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L1" style=""><span class="pln">&nbsp;</span></li><li class="L2" style=""><span class="kwd" style="color: rgb(0, 0, 136);">char</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">BasicBlocksDemo</span><span class="pun" style="color: rgb(102, 102, 0);">::</span><span class="pln">ID </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L3" style=""><span class="kwd" style="color: rgb(0, 0, 136);">static</span><span class="pln"> </span><span class="typ" style="color: rgb(102, 0, 102);">RegisterPass</span><basicblocksdemo><span class="pln"> X</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="str" style="color: rgb(0, 136, 0);">&quot;bbdemo&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="str" style="color: rgb(0, 136, 0);">&quot;BasicBlocksDemo Pass&quot;</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">false</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">false</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></basicblocksdemo></li><li class="L4"><basicblocksdemo></basicblocksdemo></li></ol></pre><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="profiling" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Profiling Using LLVM IR: Setup and Program Template</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The primary mechanism to use LLVM for program inspection and transformation is to write and LLVM pass. Optimizations or instrumentations with LLVM require an&nbsp;</span><a href="http://llvm.org/docs/Passes.html" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">LLVM Transform</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">in the form of an LLVM Plugin. The following instructions will help you setup your computer for writing your own LLVM plugin. You will complete the probject by filling in the details of the appropriate functions in a plugin template as described below.&nbsp;</span><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><br style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">These instructions have been tested and verified on Debian/Ubuntu Linux and Mac OS X operating systems.</span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li>Install&nbsp;<a href="http://clang.llvm.org/">clang</a>&nbsp;on your computer. On Ubuntu,&nbsp;<tt>sudo apt-get install clang</tt>&nbsp;will install the most recent version.</li><li>Create a Directory named&nbsp;<tt>Workspace</tt>&nbsp;in your home directory:&nbsp;<tt>mkdir -p ~/Workspace &amp;&amp; cd ~/Workspace</tt></li><li>Download LLVM source codefrom&nbsp;<a href="http://llvm.org/releases/3.6.0/llvm-3.6.0.src.tar.xz">http://llvm.org/releases/3.6.0/llvm-3.6.0.src.tar.xz</a>&nbsp;to ~/Workspace/ [LLVM is&nbsp;<b>NOT</b>&nbsp;installed on the CS servers (bell and well)].</li><li>Extract the sources:&nbsp;<code>cd ~/Workspace &amp;&amp; tar xvf llvm-3.6.0.src.tar.xz &amp;&amp; mv llvm-3.6.0.src llvm</code></li><li>Build LLVM from source:&nbsp;<code>cd ~/Workspace/llvm &amp;&amp; ./configure &amp;&amp; make</code>. If your computer has spare CPUs, you can run&nbsp;<tt>make -j 4</tt>&nbsp;for faster builds.</li><li>Download the skeleton LLVM plugin from&nbsp;<a href="https://www.dropbox.com/s/xymk2fe5qovmo3b/CS201Profiling.zip?dl=0">here</a>&nbsp;and extract the zip file to&nbsp;<code>~/Workspace/llvm/lib/Transforms/</code></li><li>Fill&nbsp;n the details for&nbsp;<code class="prettify lang-c">doInitialization(Module &amp;M), runOnFunction(Function &amp;F) and doFinalize(Module &amp;M)</code>&nbsp;methods</li><li>Build and test the plugin using LLVM&#39;s&nbsp;<tt>opt</tt>&nbsp;tool on the sample input programs using the&nbsp;<tt>buildAndTest.sh</tt>&nbsp;command on the sample &#39;test&#39; input in the support folder:&nbsp;<tt>cd ~/Workspace/llvm/lib/Transforms/CS201Profiling &amp;&amp; ./buildAndTest.sh test</tt></li></ol><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="output" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><p style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Output Requirements</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Instrumented programs should output the number of times each Basic Block, Edge, and Loop was executed during the run of the program. Since there are many reasonable ways this can be done, we are going to leave the specifics up to you. There are however, some broad requirements.</span></p><p style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">First, you need to report the predecessors set and dominators set for each Basic Block. This way, we will be able to identify whether or not you have identified the correct CFG for programs. If these can&#39;t be determined from your output, your score will be penalized accordingly. Second, you need to find the loops and report the set of basic blocks in each loop. Then, you instrument the code to gather basic block, edge and loop profiles.</p><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="exampleOutputs" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><p style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Here is an example of a C program that we might want to instrument:</p><h4 style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Example C Program</h4><pre class="prettyprint linenums lang-c prettyprinted" style="padding: 2px; border: 1px solid rgb(136, 136, 136); line-height: normal; widows: 1;"><ol class="linenums list-paddingleft-2" style="margin-top: 0px; margin-bottom: 0px;"><li class="L0" style=""><span class="kwd" style="color: rgb(0, 0, 136);">void</span><span class="pln"> function_1</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);">unsigned</span><span class="pln"> x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp;ENTRY</span><span class="pun" style="color: rgb(102, 102, 0);">:</span></li><li class="L2" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">if</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">(!(</span><span class="pln">x </span><span class="pun" style="color: rgb(102, 102, 0);">&gt;</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">))</span><span class="pln"> </span><span class="kwd" style="color: rgb(0, 0, 136);">goto</span><span class="pln"> EXIT</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L3" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">if</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln">x </span><span class="pun" style="color: rgb(102, 102, 0);">%</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">4</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">==</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L4"><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">--</span><span class="pln">x</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">else</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L7" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">--</span><span class="pln">x</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L8" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L9" style="background-position: initial initial; background-repeat: initial initial;"><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">goto</span><span class="pln"> ENTRY</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L0" style=""><span class="pln"> &nbsp; &nbsp;EXIT</span><span class="pun" style="color: rgb(102, 102, 0);">:</span></li><li class="L1" style=""><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L2" style=""><span class="pun" style="color: rgb(102, 102, 0);">}</span></li><li class="L3" style=""><span class="pln">&nbsp;</span></li><li class="L4"><span class="typ" style="color: rgb(102, 0, 102);">int</span><span class="pln"> main</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></li><li class="L5" style=""><span class="pln"> &nbsp; &nbsp;function_1</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">100</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></li><li class="L6" style=""><span class="pln"> &nbsp; &nbsp;</span><span class="kwd" style="color: rgb(0, 0, 136);">return</span><span class="pln"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></li><li class="L7" style=""><span class="pun" style="color: rgb(102, 102, 0);">}</span></li></ol></pre><h4 style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Example Instrumentation Output</h4><pre style="line-height: normal; widows: 1;">Function: function_1
BasicBlock: 
b:
  %0 = alloca i32, align 4
  store i32 %x, i32* %0, align 4
  br label %b1
  %0 = load i32* @bbCounter
  %1 = add i32 1, %0
  store i32 %1, i32* @bbCounter
  %2 = alloca i32, align 4
  store i32 %x, i32* %2, align 4
  br label %b1
  
BasicBlock: 
b1:                                               ; preds = %b6, %b
  %3 = load i32* %2, align 4
  %4 = icmp ugt i32 %3, 0
  br i1 %4, label %b3, label %b2
  %3 = load i32* @bbCounter
  %4 = add i32 1, %3
  store i32 %4, i32* @bbCounter
  %5 = load i32* %2, align 4
  %6 = icmp ugt i32 %5, 0
  br i1 %6, label %b3, label %b2
  
BasicBlock: 
b2:                                               ; preds = %b1
  br label %b7
  %7 = load i32* @bbCounter
  %8 = add i32 1, %7
  store i32 %8, i32* @bbCounter
  br label %b7
  
BasicBlock: 
b3:                                               ; preds = %b1
  %9 = load i32* %2, align 4
  %10 = urem i32 %9, 4
  %11 = icmp eq i32 %10, 0
  br i1 %11, label %b4, label %b5
  %9 = load i32* @bbCounter
  %10 = add i32 1, %9
  store i32 %10, i32* @bbCounter
  %11 = load i32* %2, align 4
  %12 = urem i32 %11, 4
  %13 = icmp eq i32 %12, 0
  br i1 %13, label %b4, label %b5
  
BasicBlock: 
b4:                                               ; preds = %b3
  %14 = load i32* %2, align 4
  %15 = add i32 %14, -1
  store i32 %15, i32* %2, align 4
  br label %b6
  %14 = load i32* @bbCounter
  %15 = add i32 1, %14
  store i32 %15, i32* @bbCounter
  %16 = load i32* %2, align 4
  %17 = add i32 %16, -1
  store i32 %17, i32* %2, align 4
  br label %b6
  
BasicBlock: 
b5:                                               ; preds = %b3
  %18 = load i32* %2, align 4
  %19 = add i32 %18, -1
  store i32 %19, i32* %2, align 4
  br label %b6
  %18 = load i32* @bbCounter
  %19 = add i32 1, %18
  store i32 %19, i32* @bbCounter
  %20 = load i32* %2, align 4
  %21 = add i32 %20, -1
  store i32 %21, i32* %2, align 4
  br label %b6
  
BasicBlock: 
b6:                                               ; preds = %b5, %b4
  br label %b1
  %22 = load i32* @bbCounter
  %23 = add i32 1, %22
  store i32 %23, i32* @bbCounter
  br label %b1
  
BasicBlock: 
b7:                                               ; preds = %b2
  ret void
  %24 = load i32* @bbCounter
  %25 = add i32 1, %24
  store i32 %25, i32* @bbCounter
  ret void
  
DominatorSets:
DomSet[b0]  =&gt; b0  
DomSet[b1]  =&gt; b0 , b1  
DomSet[b2]  =&gt; b0 , b1 , b2  
DomSet[b3]  =&gt; b0 , b1 , b3  
DomSet[b4]  =&gt; b0 , b1 , b3 , b4  
DomSet[b5]  =&gt; b0 , b1 , b3 , b5  
DomSet[b6]  =&gt; b0 , b1 , b3 , b6
DomSet[b7]  =&gt; b0 , b1 , b2 , b7

Loops: 
b1 b3 b4 b5 b6 

Function: main
BasicBlock:
b:

  %1 = alloca i32, align 4
  store i32 0, i32* %1
  call void @function_1(i32 100)
  ret i32 0


</pre><p style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Finally, here is the output of the instrumented program.</p><h4 style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Example Output of Profiled Program</h4><pre style="line-height: normal; widows: 1;">BASIC BLOCK PROFILING:
b0: 1
b1: 100
b2: 1
b3: 100
b4: 25
b5: 75
b6: 100
b7: 1

EDGE PROFILING:
b0 -&gt; b1: 1
b1 -&gt; b2: 1
b1 -&gt; b3: 100
b2 -&gt; b7: 1
b3 -&gt; b4: 25
b3 -&gt; b5: 75
b4 -&gt; b6: 25
b5 -&gt; b6: 75
b6 -&gt; b1: 100

LOOP PROFILING:
b1 b3 b4 b5 b6: 100


</pre><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="More Example C Programs" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Example C Programs for Testing</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Additional C programs that you can use to test your code can be found in the support directory of the project folder.</span></p><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="submission" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Submission</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">The submission should be a tar file named &#39;username1_username2.tar&#39; (where &#39;username&#39; is your CSE account username) emailed to the TA, Arash Alavi&nbsp;</span><a href="mailto:aalav003@ucr.edu" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">aalav003@ucr.edu</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">. Also include the Name and Student-ID of each member of your submission group in your submission email. The tar file must contain:</span></p><ol style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;" class=" list-paddingleft-2"><li>The finished&nbsp;<tt>CS201Profiling/</tt>, similar to the one that you downloaded and used to complete this assignment.</li><li>The folder extracted from your submission should work as described above in&nbsp;<a href="http://www.cs.ucr.edu/~aalav003/#profiling">Profiling using LLVM: Setup and Program Template</a>, using the&nbsp;<tt>buildAndTest.sh</tt>&nbsp;script provided as part of the template.</li><li>A README listing the Name, Email and Student ID of each member of the group. Your README should also contain instructions for compiling your code and running it on an arbitrary C program.</li></ol><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><a name="reporting_problems" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"></span></p><h3 style="font-family: Times; line-height: normal; white-space: normal; widows: 1;">Reporting problems</h3><p><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">Please read this document in its&nbsp;</span><i style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">entirety</i><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">&nbsp;before you email the TA:&nbsp;</span><a href="mailto:aalav003@ucr.edu" style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">aalav003@ucr.edu</a><span style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;">.</span></p><hr style="font-family: Times; font-size: medium; line-height: normal; white-space: normal; widows: 1;"/><p><br/></p></body></html>